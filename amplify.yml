version: 1
frontend:
  phases:
    preBuild:
      commands:
        # Inject environment variables into .env.local for runtime access
        - echo "MONGODB_URI=${MONGODB_URI}" >> .env.local
        - echo "MONGODB_DB=${MONGODB_DB}" >> .env.local
        - echo "CLOUDINARY_CLOUD_NAME=${CLOUDINARY_CLOUD_NAME}" >> .env.local
        - echo "CLOUDINARY_API_KEY=${CLOUDINARY_API_KEY}" >> .env.local
        - echo "CLOUDINARY_API_SECRET=${CLOUDINARY_API_SECRET}" >> .env.local
        - echo "LEOPARDS_API_BASE_URL=${LEOPARDS_API_BASE_URL}" >> .env.local
        - echo "LEOPARDS_API_KEY=${LEOPARDS_API_KEY}" >> .env.local
        - echo "LEOPARDS_API_PASSWORD=${LEOPARDS_API_PASSWORD}" >> .env.local
    build:
      commands:
        - npm ci  # Install dependencies
        - npm run build  # Build Next.js app
  artifacts:
    baseDirectory: .next  # Output directory for standalone SSR
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/*